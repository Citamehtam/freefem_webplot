<html>

<head>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/app.css">

    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <!-- <script src="js/Chart.bundle.min.js"></script> -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/svg.min.js"></script>

    <script src="js/three.min.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/data2blob.js"></script>

    <!-- <script src="js/CSS3DRenderer.js"></script> -->
    <!-- <script async src="mathjax/MathJax.js"></script> -->
    <title>FreeFem++</title>
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="#">FreeFem++</a>
    </nav>
    <main role="main" class="container">
        <div class="row">
            <div class="col-8">
                <div id="dashboard_new" class="dashboard jumbotron">
                    <div class="row plot_title">
                        <div class="d-flex flex-fill align-items-center">
                            <h6>Output</h6>
                        </div>
                        <div class="d-flex justify-content-end align-items-center">
                            <button type="button" class="btn btn-outline-secondary" id="3dstart">2D</button>
                        </div>
                    </div>
                    <div id="new_plot" style="text-align: center"></div>
                </div>
            </div>
            <div class="col-4">
                <div class="dropdown">

                </div>

                <form id="control" class="controlbox">
                    <div id="2d_control">
                        <h6>Preference</h6>
                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" id="mesh" checked>
                            <label class="form-check-label" for="mesh">mesh</label>
                        </div>
                        <div class="form-group form-check subcheck">
                            <input type="checkbox" class="form-check-input" id="tri_index">
                            <label class="form-check-label" for="tri_index">index of triangles</label>
                        </div>
                        <div class="form-group form-check subcheck">
                            <input type="checkbox" class="form-check-input" id="ver_index">
                            <label class="form-check-label" for="ver_index">index of vertices</label>
                        </div>
                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" id="edg_label">
                            <label class="form-check-label" for="edg_label">label of edges</label>
                        </div>
                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" id="level" checked>
                            <label class="form-check-label" for="level">isoline</label>
                        </div>
                        <div class="form-group form-check subcheck">
                            <input type="checkbox" class="form-check-input" id="colorbar" checked>
                            <label class="form-check-label" for="colorbar">colorbar</label>
                        </div>
                        <h6>Download</h6>
                        <div class="btn-group" role="group" aria-label="Basic example" id="2d_download_btn">
                            <a href="#" class="btn btn-outline-primary" id="2dsvg">SVG</a>
                            <a href="#" class="btn btn-outline-primary 2d_output" id="2dpng">PNG</a>
                        </div>
                    </div>
                    <div id="3d_control" style="display: none;">
                        <h6>Preference</h6>
                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" id="mesh3d" checked>
                            <label class="form-check-label" for="mesh3d">mesh</label>
                        </div>
                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" id="wireframe">
                            <label class="form-check-label" for="wireframe">wireframe</label>
                        </div>
                        <h6>Set View</h6>
                        <div class="form-group form-check">
                            <input type="checkbox" class="form-check-input" id="axes3d">
                            <label class="form-check-label" for="axes3d">axes</label>
                        </div>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-secondary" onclick="view(0,0,frustumSize)">XY</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="view(frustumSize,0,0)">YZ</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="view(0,frustumSize,0)">XZ</button>
                        </div>
                        <br>
                        <br>
                        <h6>Download</h6>
                        <div class="btn-group" role="group" id="3d_download_btn">
                            <a href="#" class="btn btn-outline-primary" id="3dpng">PNG</a>
                        </div>
                    </div>
                </form>

            </div>
        </div>
        <canvas id="temp_canvas"></canvas>
    </main>

</body>
<script>
    var mesh_data;
    var vertex_data;
    var edge_data;
    var minmax_data;
    var basic_data;

    var cprofile1 = ["#0000ff", "#00ffff", "#00ff00", "#ffff00", "#ff0000"];
    var cprofile2 = ["#112F41", "#0894A1", "#47AB6C", "#F2B134", "#ED553B"];
    var cprofile3 = ["#955BA5", "#2D95BF", "#4EBA6F", "#F0C419", "#F15A5A"];

    var cprofile = cprofile3;

    $(document).ready(function () {
        function mesh_ajax() {
            return $.ajax({
                url: './mesh',
                type: 'GET'
            }).done((m) => {
                console.log(m);
                mesh_data = m;
            }).fail((xhr, status, error) => {
                console.log("Status: " + status + " Error: " + error);
                console.log(xhr);
            })
        }

        function vertex_ajax() {
            return $.ajax({
                url: './vertex',
                type: 'GET'
            }).done((m) => {
                console.log(m);
                vertex_data = m.position;
                minmax_data = m.minmax;
            }).fail((xhr, status, error) => {
                console.log("Status: " + status + " Error: " + error);
                console.log(xhr);
            })
        }

        function edge_ajax() {
            return $.ajax({
                url: './edge',
                type: 'GET'
            }).done((m) => {
                console.log(m);
                edge_data = m;
            }).fail((xhr, status, error) => {
                console.log("Status: " + status + " Error: " + error);
                console.log(xhr);
            })
        }

        function basic_ajax() {
            return $.ajax({
                url: './basic',
                type: 'GET'
            }).done((m) => {
                console.log(m);
                basic_data = m;
                init();
                animate();
                $("#new_plot").children("canvas").hide();
            }).fail((xhr, status, error) => {
                console.log("Status: " + status + " Error: " + error);
                console.log(xhr);
            })
        }
        basic_ajax();

        $.when(mesh_ajax(), vertex_ajax(), edge_ajax()).done(function () {
            mydraw();
        })

        $("#control").find('input[type="checkbox"]').change(function () {
            if ($("#3dstart").text() == '2D') {
                mydraw();
            } else {
                mygenerate();
            }
        });


        //3d switch
        $('#3dstart').click(function () {
            if ($("#new_plot").children("svg").is(":hidden")) {
                //2D mode
                $(this).text('2D');
                $("#new_plot").children("svg").show();
                mydraw();
                $("#new_plot").children("canvas").hide();
                $('#2d_control').show();
                $('#3d_control').hide();
                // disenable camera orbit control
                controls.enabled = false;
            } else {
                //3D mode
                $(this).text('3D');
                $("#new_plot").children("canvas").show();
                mygenerate();
                $("#new_plot").children('svg').hide();
                $('#2d_control').hide();
                $('#3d_control').show();
                // enable camera orbit control
                controls.enabled = true;
            }

        });

    });

</script>
<script src="js/freefem2d.js"></script>
<script src="js/freefem3d.js"></script>

</html>