<html>

<head>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/app.css">

    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <!-- <script src="js/Chart.bundle.min.js"></script> -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/svg.min.js"></script>

    <!-- <script async src="mathjax/MathJax.js"></script> -->



    <!-- Latest compiled and minified JavaScript -->
    <title>FreeFem++</title>
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="#">FreeFem++</a>
    </nav>
    <main role="main" class="container">
        <div class="row">
            <div class="col-8">
                <div id="dashboard_new" class="dashboard jumbotron">
                    <p>--output--</p>
                    <div id="new_plot" style="text-align: center" ></div>
                </div>
            </div>
            <div class="col-4">

                <!-- <div id="scheme" class="btn-group scheme" role="group" aria-label="...">
                <button type="button" class="btn btn-default" id="m0">Default</button>
                <button type="button" class="btn btn-default" id="m1">M1</button>
                <button type="button" class="btn btn-default" id="m2">M2</button>
                <button type="button" class="btn btn-default" id="m3">M3</button>
            </div> -->

                <div class="dropdown">

                </div>

                <form id="control" class="controlbox">
                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="mesh" checked>
                        <label class="form-check-label" for="mesh">mesh</label>
                    </div>
                    <div class="form-group form-check subcheck">
                        <input type="checkbox" class="form-check-input" id="tri_index">
                        <label class="form-check-label" for="tri_index">index of triangles</label>
                    </div>
                    <div class="form-group form-check subcheck">
                        <input type="checkbox" class="form-check-input" id="ver_index">
                        <label class="form-check-label" for="ver_index">index of vertices</label>
                    </div>
                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="edg_label">
                        <label class="form-check-label" for="edg_label">label of edges</label>
                    </div>
                </form>

            </div>
        </div>
    </main>

</body>
<script>
var mesh_data;
var vertex_data;
var edge_data;

var draw = SVG('new_plot')

$(document).ready(function () {    

    $.ajax({
        url:'./mesh',
        type: 'GET'
    }).done((m)=>{
        console.log(m);
        mesh_data = m;
        mydraw()
    }).fail((xhr, status, error) =>{
        console.log("Status: " + status + " Error: " + error);
        console.log(xhr);
    })

    $.ajax({
        url: './vertex',
        type: 'GET'
    }).done((m) => {
        console.log(m);
        vertex_data = m;
        mydraw()

    }).fail((xhr, status, error) => {
        console.log("Status: " + status + " Error: " + error);
        console.log(xhr);
    })

    $.ajax({
        url: './edge',
        type: 'GET'
    }).done((m) => {
        console.log(m);
        edge_data = m;
        mydraw()

    }).fail((xhr, status, error) => {
        console.log("Status: " + status + " Error: " + error);
        console.log(xhr);
    })


    $("#mesh").change(function () {
        mydraw();
    });

    $("#tri_index").change(function () {
        mydraw();
    });

    $("#ver_index").change(function () {
        mydraw();
    });

    $("#edg_label").change(function () {
        mydraw();
    });

    
    
});

function mydraw() {
    const w = 1;
    const h = -1;
    draw.clear()
    $("#new_plot > svg").attr('height','');
    draw.viewbox({ x: -0.05, y: -0.05, width: 1.1, height: 1.1 })
    if ($("#mesh").is(':checked')){
        mesh_data.forEach((e, i) => {
            var polyline = draw.polygon([[e[0].x * w, e[0].y * h + 1], [e[1].x * w, e[1].y * h + 1], [e[2].x * w, e[2].y * h + 1]])
            polyline.fill('none').stroke({ width: 1 / 500 })
            if ($("#tri_index").is(':checked')) {
                var text = draw.plain(i).attr('x', (e[0].x + e[1].x + e[2].x) / 3 * w).attr('y', (e[0].y + e[1].y + e[2].y) / 3 * h + 1)
                    .font({
                        size: "0.02px",
                        anchor: 'middle'
                    })
            }
        });

        if ($("#ver_index").is(':checked') && typeof vertex_data !== 'undefined') {
            vertex_data.forEach((e, i) => {
                var circle = draw.circle(1 / 100).attr('cx', e.x).attr('cy', e.y * h + 1);
                var text = draw.plain(i).attr('x', e.x * w - 0.015).attr('y', e.y * h + 1 - 0.01)
                    .font({
                        size: "0.02px",
                        anchor: 'middle',
                        fill: '#0000FF'
                    })
            })

        }
    }else{
        edge_data.forEach((e, i) => {
            var line = draw.line(e.vertices[0].x * w, e.vertices[0].y * h + 1, e.vertices[1].x * w, e.vertices[1].y * h + 1)
                .stroke({ width: 1 / 500 });
        })
    }
    



    if ($("#edg_label").is(':checked') && typeof edge_data !== 'undefined') {
        edge_data.forEach((e, i) => {
            var line = draw.line(e.vertices[0].x*w, e.vertices[0].y*h+1, e.vertices[1].x*w, e.vertices[1].y*h+1)
                        .stroke({ width: 1/500 }).stroke({color: '#f06'});
            var text = draw.plain(e.label).attr('x', (e.vertices[0].x+ e.vertices[1].x)/2 * w - 0.015).attr('y', (e.vertices[0].y+ e.vertices[1].y)/2 * h + 1 )
                .font({
                    size: "0.02px",
                    anchor: 'middle',
                    fill: '#f06'
                })
        })

    }
    
}



</script>

</html>